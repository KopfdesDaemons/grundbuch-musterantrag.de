<section>
  <div class="content-spacer">
    <div class="tableHeader">
      <button class="reloadBtn" (click)="reloadFiles()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
          <path
            d="M552 256L408 256C398.3 256 389.5 250.2 385.8 241.2C382.1 232.2 384.1 221.9 391 215L437.7 168.3C362.4 109.7 253.4 115 184.2 184.2C109.2 259.2 109.2 380.7 184.2 455.7C259.2 530.7 380.7 530.7 455.7 455.7C463.9 447.5 471.2 438.8 477.6 429.6C487.7 415.1 507.7 411.6 522.2 421.7C536.7 431.8 540.2 451.8 530.1 466.3C521.6 478.5 511.9 490.1 501 501C401 601 238.9 601 139 501C39.1 401 39 239 139 139C233.3 44.7 382.7 39.4 483.3 122.8L535 71C541.9 64.1 552.2 62.1 561.2 65.8C570.2 69.5 576 78.3 576 88L576 232C576 245.3 565.3 256 552 256z"
          />
        </svg>
      </button>
      <span>Anträge: {{ uploadsS.totalFiles() }} </span>
      <button class="btn-text" (click)="deleteFolder()">alle löschen</button>
    </div>

    @if (error() || uploadsS.uploadsResource.error()) {
      <app-error-display [error]="error() ?? uploadsS.uploadsResource.error()"></app-error-display>
    } @else {
      <div class="tablehorizontal-scroll-container" (scroll)="scroll($event.target)">
        <table>
          <thead>
            <tr>
              <th>uploadID</th>
              <th>Grundbuchamt</th>
              <th>Antragsart</th>
              <th>Datum</th>
              <th>.odt</th>
              <th>.pdf</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            @for (file of uploadsS.uploads(); track file) {
              <tr>
                <td class="uploadID" title="{{ file.uploadID }}">{{ file.uploadID }}</td>
                <td>{{ file.grundbuchamt }}</td>
                <td>
                  <div class="antragsart">{{ file.antragsart }}</div>
                </td>
                <td>{{ file.uploadDate | date: "dd.MM.yyyy HH:mm" }} Uhr</td>

                <td class="icon-table-cell">
                  @if (file.odtFile && !file.filesDeleted) {
                    <button class="btn-icon" (click)="getFile(file.uploadID, 'odt')" title="Download .odt Datei">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                        <path
                          fill="currentColor"
                          d="M320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64zM308.7 451.3L204.7 347.3C200.1 342.7 198.8 335.8 201.2 329.9C203.6 324 209.5 320 216 320L272 320L272 224C272 206.3 286.3 192 304 192L336 192C353.7 192 368 206.3 368 224L368 320L424 320C430.5 320 436.3 323.9 438.8 329.9C441.3 335.9 439.9 342.8 435.3 347.3L331.3 451.3C325.1 457.5 314.9 457.5 308.7 451.3z"
                        />
                      </svg>
                    </button>
                  } @else if (file.odtFile && file.filesDeleted) {
                    <svg
                      class="check"
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 640 640"
                      title="Datei wurde generiert und nach dem Response gelöscht"
                    >
                      <path
                        fill="currentColor"
                        d="M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z"
                      />
                    </svg>
                  } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="btn-icon notFound">
                      <path
                        fill="currentColor"
                        d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM320 384C302.3 384 288 398.3 288 416C288 433.7 302.3 448 320 448C337.7 448 352 433.7 352 416C352 398.3 337.7 384 320 384zM320 192C301.8 192 287.3 207.5 288.6 225.7L296 329.7C296.9 342.3 307.4 352 319.9 352C332.5 352 342.9 342.3 343.8 329.7L351.2 225.7C352.5 207.5 338.1 192 319.8 192z"
                      />
                    </svg>
                  }
                </td>

                <td class="icon-table-cell">
                  @if (file.pdfFile && !file.filesDeleted) {
                    <button class="btn-icon" target="_blank" (click)="getFile(file.uploadID, 'pdf')" title=".pdf Datei öffnen">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                        <path
                          fill="currentColor"
                          d="M384 64C366.3 64 352 78.3 352 96C352 113.7 366.3 128 384 128L466.7 128L265.3 329.4C252.8 341.9 252.8 362.2 265.3 374.7C277.8 387.2 298.1 387.2 310.6 374.7L512 173.3L512 256C512 273.7 526.3 288 544 288C561.7 288 576 273.7 576 256L576 96C576 78.3 561.7 64 544 64L384 64zM144 160C99.8 160 64 195.8 64 240L64 496C64 540.2 99.8 576 144 576L400 576C444.2 576 480 540.2 480 496L480 416C480 398.3 465.7 384 448 384C430.3 384 416 398.3 416 416L416 496C416 504.8 408.8 512 400 512L144 512C135.2 512 128 504.8 128 496L128 240C128 231.2 135.2 224 144 224L224 224C241.7 224 256 209.7 256 192C256 174.3 241.7 160 224 160L144 160z"
                        />
                      </svg>
                    </button>
                  } @else if (file.pdfFile && file.filesDeleted) {
                    <svg
                      class="check"
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 640 640"
                      title="Datei wurde generiert und nach dem Response gelöscht"
                    >
                      <path
                        fill="currentColor"
                        d="M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z"
                      />
                    </svg>
                  } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="btn-icon notFound">
                      <path
                        fill="currentColor"
                        d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM320 384C302.3 384 288 398.3 288 416C288 433.7 302.3 448 320 448C337.7 448 352 433.7 352 416C352 398.3 337.7 384 320 384zM320 192C301.8 192 287.3 207.5 288.6 225.7L296 329.7C296.9 342.3 307.4 352 319.9 352C332.5 352 342.9 342.3 343.8 329.7L351.2 225.7C352.5 207.5 338.1 192 319.8 192z"
                      />
                    </svg>
                  }
                </td>

                <td class="dropDown">
                  <button class="btn-icon" (click)="clickOnDropdown($event.target)">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                      <path
                        fill="currentColor"
                        d="M320 208C289.1 208 264 182.9 264 152C264 121.1 289.1 96 320 96C350.9 96 376 121.1 376 152C376 182.9 350.9 208 320 208zM320 432C350.9 432 376 457.1 376 488C376 518.9 350.9 544 320 544C289.1 544 264 518.9 264 488C264 457.1 289.1 432 320 432zM376 320C376 350.9 350.9 376 320 376C289.1 376 264 350.9 264 320C264 289.1 289.1 264 320 264C350.9 264 376 289.1 376 320z"
                      />
                    </svg>
                  </button>
                  <ul class="dropDownMenu">
                    <li (click)="deleteUpload(file.uploadID)">Upload&nbsp;komplett&nbsp;löschen</li>
                    @if (!file.filesDeleted) {
                      <li (click)="deleteGeneratedFiles(file.uploadID)">Nur&nbsp;generierte&nbsp;Dateien&nbsp;löschen (Upload&nbsp;beibehalten)</li>
                    }
                  </ul>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>
</section>
